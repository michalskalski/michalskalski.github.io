<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Nix</title>
<meta name="author" content="Michal Skalski"/>
<style type="text/css">
.underline { text-decoration: underline; }
</style>
<link rel="stylesheet" href="./reveal.js/dist/reveal.css"/>

<link rel="stylesheet" href="./reveal.js/dist/theme/white.css" id="theme"/>
</head>
<body>
<div class="reveal">
<div class="slides">
<section id="sec-title-slide" data-background="https://upload.wikimedia.org/wikipedia/commons/2/28/Nix_snowflake.svg" data-background-size="60%" data-background-opacity="40%">
<h1 class="title">Nix</h1><h2 class="author">Michal Skalski</h2>
</section>

<section>
<section id="slide-orgea39003" data-background="https://upload.wikimedia.org/wikipedia/commons/2/28/Nix_snowflake.svg" data-background-size="60%" data-background-opacity="40%">
<h2 id="orgea39003">What is nix?</h2>
<p>
<i>A single tool to rule them all.</i>
</p>

<ul>
<li class="fragment appear">language (domain specific)</li>
<li class="fragment appear"><a href="https://github.com/NixOS/nixpkgs">package manager</a></li>
<li class="fragment appear">main pilar of <a href="https://nixos.org/">NixOS</a> - operating system</li>

</ul>

</section>
<section id="slide-orgb1f903c" data-background="https://upload.wikimedia.org/wikipedia/commons/2/28/Nix_snowflake.svg" data-background-size="60%" data-background-opacity="40%">
<h3 id="orgb1f903c">Origins</h3>
<p>
PhD project of Eelco Dolstra
</p>

<ul>
<li><a href="https://edolstra.github.io/pubs/immdsd-icse2004-final.pdf">Imposing a Memory Management Discipline on Software Deployment (2004)</a></li>
<li><a href="https://edolstra.github.io/pubs/phd-thesis.pdf">The Purely Functional Software Deployment Model (2005)</a></li>

</ul>

<p>
Initially intended to be alternative to <code>make</code> and package managers like <code>rpm</code>
</p>

</section>
<section id="slide-org9f83446" data-background="https://upload.wikimedia.org/wikipedia/commons/2/28/Nix_snowflake.svg" data-background-size="60%" data-background-opacity="40%">
<h3 id="org9f83446">What problmes it tried to solve?</h3>
<p>
Classical package managers issues:
</p>

<ul>
<li>DLL hell</li>
<li>Destructive upgrades</li>
<li>No rollbacks</li>
<li>Not atomic</li>
<li>Hard to prevent undeclared dependencies</li>

</ul>

<p>
<i>YouTube: <a href="https://www.youtube.com/watch?v=h8hWX_aGGDc">Eelco Dolstra - The Evolution of Nix</a></i>
</p>

</section>
<section id="slide-orge45fa3b" data-background="https://upload.wikimedia.org/wikipedia/commons/2/28/Nix_snowflake.svg" data-background-size="60%" data-background-opacity="40%">
<h3 id="orge45fa3b">Filesystem Hierarchy Standard</h3>
<div class="org-src-container">

<pre class="src src-fish"><span style="color: #9ca0a4;"># </span><span style="color: #9ca0a4;">list of files installed on filesystem by wget pkg</span>
$ dpkg -L wget
...
<span style="color: #a626a4;">/etc/wgetrc</span>
<span style="color: #a626a4;">/usr/bin/wget</span>
<span style="color: #a626a4;">/usr/share/doc/wget/README</span>
<span style="color: #a626a4;">/usr/share/man/man1/wget</span>.<span style="color: #da8548; font-weight: bold;">1</span>.gz
</pre>
</div>

<div class="org-src-container">

<pre class="src src-fish"><span style="color: #9ca0a4;"># </span><span style="color: #9ca0a4;">dynamically linked libraries</span>
$ ldd /usr/bin/wget
<span style="color: #a626a4;">libpcre2-8</span>.so.<span style="color: #da8548; font-weight: bold;">0</span> =&gt; /lib/x86_64-linux-gnu/libpcre2-8.so.<span style="color: #da8548; font-weight: bold;">0</span>
<span style="color: #a626a4;">libuuid</span>.so.<span style="color: #da8548; font-weight: bold;">1</span> =&gt; /lib/x86_64-linux-gnu/libuuid.so.<span style="color: #da8548; font-weight: bold;">1</span>
<span style="color: #a626a4;">libidn2</span>.so.<span style="color: #da8548; font-weight: bold;">0</span> =&gt; /lib/x86_64-linux-gnu/libidn2.so.<span style="color: #da8548; font-weight: bold;">0</span>
<span style="color: #a626a4;">libssl</span>.so.<span style="color: #da8548; font-weight: bold;">3</span> =&gt; /lib/x86_64-linux-gnu/libssl.so.<span style="color: #da8548; font-weight: bold;">3</span>
<span style="color: #a626a4;">libcrypto</span>.so.<span style="color: #da8548; font-weight: bold;">3</span> =&gt; /lib/x86_64-linux-gnu/libcrypto.so.<span style="color: #da8548; font-weight: bold;">3</span>
<span style="color: #a626a4;">libz</span>.so.<span style="color: #da8548; font-weight: bold;">1</span> =&gt; /lib/x86_64-linux-gnu/libz.so.<span style="color: #da8548; font-weight: bold;">1</span>
<span style="color: #a626a4;">libpsl</span>.so.<span style="color: #da8548; font-weight: bold;">5</span> =&gt; /lib/x86_64-linux-gnu/libpsl.so.<span style="color: #da8548; font-weight: bold;">5</span>
<span style="color: #a626a4;">libc</span>.so.<span style="color: #da8548; font-weight: bold;">6</span> =&gt; /lib/x86_64-linux-gnu/libc.so.<span style="color: #da8548; font-weight: bold;">6</span>
<span style="color: #a626a4;">/lib64/ld-linux-x86-64</span>.so.<span style="color: #da8548; font-weight: bold;">2</span>
<span style="color: #a626a4;">libunistring</span>.so.<span style="color: #da8548; font-weight: bold;">2</span> =&gt; /lib/x86_64-linux-gnu/libunistring.so.<span style="color: #da8548; font-weight: bold;">2</span>
</pre>
</div>

</section>
<section id="slide-org3de6978" data-background="https://upload.wikimedia.org/wikipedia/commons/2/28/Nix_snowflake.svg" data-background-size="60%" data-background-opacity="40%">
<h3 id="org3de6978">Filesystem as memory</h3>
<div style="font-size: 40%;">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Programming Language Domain</th>
<th scope="col" class="org-left">Deployment Domain</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">memory</td>
<td class="org-left">disk</td>
</tr>

<tr>
<td class="org-left">value, object</td>
<td class="org-left">file</td>
</tr>

<tr>
<td class="org-left">address</td>
<td class="org-left">path name</td>
</tr>

<tr>
<td class="org-left">pointer dereference</td>
<td class="org-left">file access</td>
</tr>

<tr>
<td class="org-left">pointer arithmetic</td>
<td class="org-left">string operations</td>
</tr>

<tr>
<td class="org-left">dangling pointer</td>
<td class="org-left">path to absent file</td>
</tr>

<tr>
<td class="org-left">object graph</td>
<td class="org-left">dependency graph</td>
</tr>

<tr>
<td class="org-left">calling constructed object with reference to other object</td>
<td class="org-left">runtime dependency</td>
</tr>

<tr>
<td class="org-left">calling constructor with reference to other object, not stored</td>
<td class="org-left">build-time dependency</td>
</tr>

<tr>
<td class="org-left">calling constructor with reference to other object, stored</td>
<td class="org-left">retained dependency</td>
</tr>

<tr>
<td class="org-left">languages without pointer discipline (e.g. assembler)</td>
<td class="org-left">typical Unix-style deployment</td>
</tr>

<tr>
<td class="org-left">languages with enough pointer discipline to support conservative garbage collection (e.g. C, C++)</td>
<td class="org-left">Nix</td>
</tr>

<tr>
<td class="org-left">languages with full pointer discipline (e.g. Java, Haskell)</td>
<td class="org-left">as-yet unknown deployment style not enabled  by contemporary operating systems</td>
</tr>
</tbody>
</table>
<p>
<i>Source: The Purely Functional Software Deployment Model</i>
</p>
</div>

</section>
<section id="slide-org0643b10" data-background="https://upload.wikimedia.org/wikipedia/commons/2/28/Nix_snowflake.svg" data-background-size="60%" data-background-opacity="40%">
<h3 id="org0643b10">Isolation, reliable identification</h3>
<p>
How to avoid address (file path) collision problem?
</p>
<ul>
<li class="fragment appear">component name, version is not enough</li>
<li class="fragment appear">random address is inefficient, generates duplicates</li>

</ul>

</section>
<section id="slide-org4fafd66" data-background="https://upload.wikimedia.org/wikipedia/commons/2/28/Nix_snowflake.svg" data-background-size="60%" data-background-opacity="40%">
<h3 id="org4fafd66">Hash</h3>
<p>
The hash is computed over all inputs, including the following:
</p>

<ul>
<li class="fragment appear">The sources of the components.</li>
<li class="fragment appear">The script that performed the build.</li>
<li class="fragment appear">Any arguments or environment variables passed to the build script.</li>
<li class="fragment appear">All build time dependencies, typically including the compiler, linker, any libraries used at build time, standard Unix tools such as cp and tar, the shell, and so on..</li>

</ul>

</section>
<section id="slide-org52aad4b" data-background="https://upload.wikimedia.org/wikipedia/commons/2/28/Nix_snowflake.svg" data-background-size="60%" data-background-opacity="40%">
<h3 id="org52aad4b">Nix store</h3>
<div style="font-size: 60%;">
<div class="org-src-container">

<pre class="src src-fish">$ which wget
<span style="color: #a626a4;">/nix/store/d3kkv9vjb3ljh7hr5v38gls8iykvwkny-wget-1</span>.<span style="color: #da8548; font-weight: bold;">21</span>.4/bin/wget

$ ldd /nix/store/d3kkv9vjb3ljh7hr5v38gls8iykvwkny-wget-1.<span style="color: #da8548; font-weight: bold;">21</span>.4/bin/wget
<span style="color: #a626a4;">libpcre</span>.so.<span style="color: #da8548; font-weight: bold;">1</span> =&gt; /nix/store/pxl4n1lrns2xhc8f1s04srb4cphlg5cz-pcre-8.45/lib/libpcre.so.<span style="color: #da8548; font-weight: bold;">1</span>
<span style="color: #a626a4;">libuuid</span>.so.<span style="color: #da8548; font-weight: bold;">1</span> =&gt; /nix/store/y5975fancsig22f6xw22mmmffn19n8zp-util-linux-minimal-2.39-lib/lib/libuuid.so.<span style="color: #da8548; font-weight: bold;">1</span>
<span style="color: #a626a4;">libidn2</span>.so.<span style="color: #da8548; font-weight: bold;">0</span> =&gt; /nix/store/vh4pdds47783g12fmywazdx3v3kx0j4x-libidn2-2.<span style="color: #da8548; font-weight: bold;">3</span>.4/lib/libidn2.so.<span style="color: #da8548; font-weight: bold;">0</span>
<span style="color: #a626a4;">libssl</span>.so.<span style="color: #da8548; font-weight: bold;">3</span> =&gt; /nix/store/ix7cb1isdcdl4gq9hl4pdk6gyc4wrk14-openssl-3.<span style="color: #da8548; font-weight: bold;">0</span>.9/lib/libssl.so.<span style="color: #da8548; font-weight: bold;">3</span>
<span style="color: #a626a4;">libcrypto</span>.so.<span style="color: #da8548; font-weight: bold;">3</span> =&gt; /nix/store/ix7cb1isdcdl4gq9hl4pdk6gyc4wrk14-openssl-3.<span style="color: #da8548; font-weight: bold;">0</span>.9/lib/libcrypto.so.<span style="color: #da8548; font-weight: bold;">3</span>
<span style="color: #a626a4;">libz</span>.so.<span style="color: #da8548; font-weight: bold;">1</span> =&gt; /nix/store/mgz7sp9jxnk7c3rn1hvich9n0k2rjr7m-zlib-1.<span style="color: #da8548; font-weight: bold;">2</span>.13/lib/libz.so.<span style="color: #da8548; font-weight: bold;">1</span>
<span style="color: #a626a4;">libc</span>.so.<span style="color: #da8548; font-weight: bold;">6</span> =&gt; /nix/store/ayg065nw0xi1zsyi8glfh5pn4sfqd8xg-glibc-2.37-8/lib/libc.so.<span style="color: #da8548; font-weight: bold;">6</span>
<span style="color: #a626a4;">libunistring</span>.so.<span style="color: #da8548; font-weight: bold;">5</span> =&gt; /nix/store/aw137ya6rvy61zw8ydsz22xwarsr8ynf-libunistring-1.1/lib/libunistring.so.<span style="color: #da8548; font-weight: bold;">5</span>
<span style="color: #a626a4;">libdl</span>.so.<span style="color: #da8548; font-weight: bold;">2</span> =&gt; /nix/store/ayg065nw0xi1zsyi8glfh5pn4sfqd8xg-glibc-2.37-8/lib/libdl.so.<span style="color: #da8548; font-weight: bold;">2</span>
<span style="color: #a626a4;">libpthread</span>.so.<span style="color: #da8548; font-weight: bold;">0</span> =&gt; /nix/store/ayg065nw0xi1zsyi8glfh5pn4sfqd8xg-glibc-2.37-8/lib/libpthread.so.<span style="color: #da8548; font-weight: bold;">0</span>
</pre>
</div>
</div>

</section>
<section id="slide-orgba064bf" data-background="https://upload.wikimedia.org/wikipedia/commons/2/28/Nix_snowflake.svg" data-background-size="60%" data-background-opacity="40%">
<h3 id="orgba064bf">Clousers</h3>
<p>
Using hashes allow to identify <b>exact</b> build and runtime dependencies
</p>

<div class="org-src-container">

<pre class="src src-fish">$ nix-store -qR $(<span style="color: #a626a4;">which</span><span style="color: #a626a4;"> wget</span>)
<span style="color: #a626a4;">/nix/store/6kyaqlxcmfadiiq0mcdj1symv1jsp58w-xgcc-12</span>.<span style="color: #da8548; font-weight: bold;">3</span>.0-libgcc
<span style="color: #a626a4;">/nix/store/aw137ya6rvy61zw8ydsz22xwarsr8ynf-libunistring-1</span>.<span style="color: #da8548; font-weight: bold;">1</span>
<span style="color: #a626a4;">/nix/store/vh4pdds47783g12fmywazdx3v3kx0j4x-libidn2-2</span>.<span style="color: #da8548; font-weight: bold;">3.4</span>
<span style="color: #a626a4;">/nix/store/ayg065nw0xi1zsyi8glfh5pn4sfqd8xg-glibc-2</span>.37-8
<span style="color: #a626a4;">/nix/store/ix7cb1isdcdl4gq9hl4pdk6gyc4wrk14-openssl-3</span>.<span style="color: #da8548; font-weight: bold;">0.9</span>
<span style="color: #a626a4;">/nix/store/mgz7sp9jxnk7c3rn1hvich9n0k2rjr7m-zlib-1</span>.<span style="color: #da8548; font-weight: bold;">2.13</span>
<span style="color: #a626a4;">/nix/store/pxl4n1lrns2xhc8f1s04srb4cphlg5cz-pcre-8</span>.<span style="color: #da8548; font-weight: bold;">45</span>
<span style="color: #a626a4;">/nix/store/y5975fancsig22f6xw22mmmffn19n8zp-util-linux-minimal-2</span>.39-lib
<span style="color: #a626a4;">/nix/store/d3kkv9vjb3ljh7hr5v38gls8iykvwkny-wget-1</span>.<span style="color: #da8548; font-weight: bold;">21.4</span>
</pre>
</div>
</section>
<section data-background="https://upload.wikimedia.org/wikipedia/commons/2/28/Nix_snowflake.svg" data-background-size="60%" data-background-opacity="40%">
<div class="org-src-container">

<pre class="src src-fish"><span style="color: #a626a4;">nix-store</span> -q --graph $(<span style="color: #a626a4;">which</span><span style="color: #a626a4;"> wget</span>)
</pre>
</div>

<div id="orgf92b48b" class="figure">
<p><img src="./images/wget-clouser.png" alt="wget-clouser.png" />
</p>
</div>
<div style="font-size: 60%;">
<p>
<i>Clouser of runtime dependencies</i>
</p>
</div>
</section>
<section data-background="https://upload.wikimedia.org/wikipedia/commons/2/28/Nix_snowflake.svg" data-background-size="60%" data-background-opacity="40%">
<p>
Clousers can be distributed accross hosts
</p>
<div class="org-src-container">

<pre class="src src-fish"><span style="color: #a626a4;">nix</span> copy --to ssh-ng://remote-host /nix/store/qh4y4iw...
</pre>
</div>

<p>
which is used to create distributed <a href="https://nixos.org/manual/nix/stable/advanced-topics/distributed-builds.html">build</a> and <a href="https://nixos.wiki/wiki/Binary_Cache">cache</a> systems.
</p>
</section>
<section id="slide-org07375ca" data-background="https://upload.wikimedia.org/wikipedia/commons/2/28/Nix_snowflake.svg" data-background-size="60%" data-background-opacity="40%">
<h3 id="org07375ca">Garbage collection</h3>
<div style="font-size: 75%;">
<div class="org-src-container">

<pre class="src src-fish">$ nix-collect-garbage
<span style="color: #a626a4;">finding</span> garbage collector roots...
<span style="color: #a626a4;">removing</span> stale temporary roots file <span style="color: #50a14f;">'/nix/var/nix/temproots/1023955'</span>
<span style="color: #a626a4;">deleting</span> garbage...
<span style="color: #a626a4;">deleting</span> <span style="color: #50a14f;">'/nix/store/mvqj8avzhkqabkg51cyz617qnhzzawhl-anstyle-wincon-1.0.1'</span>
<span style="color: #a626a4;">deleting</span> <span style="color: #50a14f;">'/nix/store/xzspb26l48b7hlhmlp6ac6sbivil0kgj-rust-operator-deps-0.1.0'</span>
<span style="color: #a626a4;">deleting</span> <span style="color: #50a14f;">'/nix/store/q512fyfmpmdw0ap391j8vkdd8j435545-rust-operator-deps-0.1.0'</span>
<span style="color: #a626a4;">deleting</span> <span style="color: #50a14f;">'/nix/store/gdnzfmns1ryh2pg5z9zbl0jgdspmmmx0-vendor-cargo-deps'</span>
...
<span style="color: #a626a4;">deleting</span> unused links...
<span style="color: #a626a4;">note</span>: currently hard linking saves -0.<span style="color: #da8548; font-weight: bold;">00</span> MiB
<span style="color: #da8548; font-weight: bold;">1855</span> store paths deleted, <span style="color: #da8548; font-weight: bold;">7729.65</span> MiB freed
</pre>
</div>
</div>


</section>
</section>
<section>
<section id="slide-org4825538" data-background="https://upload.wikimedia.org/wikipedia/commons/2/28/Nix_snowflake.svg" data-background-size="60%" data-background-opacity="40%">
<h2 id="org4825538">Nix expression language</h2>
<ul>
<li>pure functional</li>
<li>domain specific</li>
<li>lazy evaluation</li>

</ul>

</section>
<section id="slide-orgfc941c0" data-background="https://upload.wikimedia.org/wikipedia/commons/2/28/Nix_snowflake.svg" data-background-size="60%" data-background-opacity="40%">
<h3 id="orgfc941c0">Syntax</h3>
<div class="org-src-container">

<pre class="src src-nix"><span style="color: #9ca0a4;"># </span><span style="color: #9ca0a4;">operators</span>
nix-repl&gt; <span style="color: #da8548; font-weight: bold;">1</span> + <span style="color: #da8548; font-weight: bold;">2</span>
<span style="color: #da8548; font-weight: bold;">3</span>
nix-repl&gt; [ <span style="color: #da8548; font-weight: bold;">1</span> <span style="color: #da8548; font-weight: bold;">2</span> ] ++ [ <span style="color: #da8548; font-weight: bold;">3</span> ]
[ <span style="color: #da8548; font-weight: bold;">1</span> <span style="color: #da8548; font-weight: bold;">2</span> <span style="color: #da8548; font-weight: bold;">3</span> ]

<span style="color: #9ca0a4;"># </span><span style="color: #9ca0a4;">let ... in ..., allow repeated use of variables in scope</span>
<span style="color: #9ca0a4;"># </span><span style="color: #9ca0a4;">string interpolation</span>
nix-repl&gt; <span style="color: #e45649;">let</span>
            <span style="color: #6a1868;">name</span> = <span style="color: #50a14f;">"World"</span>;
          <span style="color: #e45649;">in</span>
            <span style="color: #50a14f;">"hello </span><span style="color: #4078f2; font-weight: bold;">${</span>name<span style="color: #4078f2; font-weight: bold;">}</span><span style="color: #50a14f;">!"</span>
hello World!

<span style="color: #9ca0a4;"># </span><span style="color: #9ca0a4;">attribute set, attributes accessible by '.'</span>
<span style="color: #9ca0a4;"># </span><span style="color: #9ca0a4;">with ..., expose attributes directly</span>
nix-repl&gt; <span style="color: #e45649;">let</span>
            <span style="color: #6a1868;">attrs</span> = { <span style="color: #6a1868;">a</span> = <span style="color: #50a14f;">"str"</span>; <span style="color: #6a1868;">b</span> = <span style="color: #a626a4;">false</span>; <span style="color: #6a1868;">i</span> = <span style="color: #da8548; font-weight: bold;">3</span>; };
          <span style="color: #e45649;">in</span>
            <span style="color: #e45649;">with</span> attrs; [ a attrs.b i ]
[ <span style="color: #50a14f;">"str"</span> <span style="color: #a626a4;">false</span> <span style="color: #da8548; font-weight: bold;">3</span> ]

</pre>
</div>
</section>
<section data-background="https://upload.wikimedia.org/wikipedia/commons/2/28/Nix_snowflake.svg" data-background-size="60%" data-background-opacity="40%">
<div class="org-src-container">

<pre class="src src-nix"><span style="color: #9ca0a4;"># </span><span style="color: #9ca0a4;">merging attr sets</span>
<span style="color: #9ca0a4;"># </span><span style="color: #9ca0a4;">dynamic typing</span>
nix-repl&gt; <span style="color: #e45649;">let</span>
            <span style="color: #6a1868;">attrs1</span> = { <span style="color: #6a1868;">a</span> = <span style="color: #50a14f;">"str"</span>; <span style="color: #6a1868;">b</span> = <span style="color: #a626a4;">false</span>; };
            <span style="color: #6a1868;">attrs2</span> = { <span style="color: #6a1868;">b</span> = <span style="color: #da8548; font-weight: bold;">10</span>; <span style="color: #6a1868;">i</span> = <span style="color: #da8548; font-weight: bold;">3</span>; };
          <span style="color: #e45649;">in</span>
            attrs1 // attrs2
{ <span style="color: #6a1868;">a</span> = <span style="color: #50a14f;">"str"</span>; <span style="color: #6a1868;">b</span> = <span style="color: #da8548; font-weight: bold;">10</span>; <span style="color: #6a1868;">i</span> = <span style="color: #da8548; font-weight: bold;">3</span>; }

<span style="color: #9ca0a4;"># </span><span style="color: #9ca0a4;">inherit, assign existing values in nested scope</span>
nix-repl&gt; :p <span style="color: #e45649;">let</span>
            <span style="color: #6a1868;">x</span> = { <span style="color: #6a1868;">b</span> = <span style="color: #da8548; font-weight: bold;">1</span>; };
            <span style="color: #6a1868;">y</span> = <span style="color: #da8548; font-weight: bold;">2</span>;
            <span style="color: #6a1868;">z</span> = <span style="color: #a626a4;">false</span>;
          <span style="color: #e45649;">in</span>
          {
            <span style="color: #e45649;">inherit</span> x y;
            <span style="color: #6a1868;">z</span> = z;
          }
{ <span style="color: #6a1868;">x</span> = { <span style="color: #6a1868;">b</span> = <span style="color: #da8548; font-weight: bold;">1</span>; }; <span style="color: #6a1868;">y</span> = <span style="color: #da8548; font-weight: bold;">2</span>; <span style="color: #6a1868;">z</span> = <span style="color: #a626a4;">false</span>; }
</pre>
</div>

</section>
<section id="slide-org74c0ff6" data-background="https://upload.wikimedia.org/wikipedia/commons/2/28/Nix_snowflake.svg" data-background-size="60%" data-background-opacity="40%">
<h3 id="org74c0ff6">Functions</h3>
<p>
Nameless function (<i>lambda</i>) always takes exactly one argument
</p>

<div class="org-src-container">

<pre class="src src-nix"><span style="color: #9ca0a4;"># </span><span style="color: #9ca0a4;">argument: function body</span>
nix-repl&gt; <span style="color: #e45649;">let</span>
            <span style="color: #6a1868;">f</span> = x: x + <span style="color: #da8548; font-weight: bold;">1</span>;
          <span style="color: #e45649;">in</span>
          {
            <span style="color: #6a1868;">type</span> = builtins.typeOf f;
            <span style="color: #6a1868;">result</span> = f <span style="color: #da8548; font-weight: bold;">1</span>;
          }
{ <span style="color: #6a1868;">result</span> = <span style="color: #da8548; font-weight: bold;">2</span>; <span style="color: #6a1868;">type</span> = <span style="color: #50a14f;">"lambda"</span>; }

<span style="color: #9ca0a4;"># </span><span style="color: #9ca0a4;">nested functions, x: (y: x + y)</span>
nix-repl&gt; <span style="color: #e45649;">let</span>
  <span style="color: #6a1868;">f</span> = x: y: x + y;
<span style="color: #e45649;">in</span>
  f <span style="color: #da8548; font-weight: bold;">1</span> <span style="color: #da8548; font-weight: bold;">2</span>
<span style="color: #da8548; font-weight: bold;">3</span>
</pre>
</div>
</section>
<section data-background="https://upload.wikimedia.org/wikipedia/commons/2/28/Nix_snowflake.svg" data-background-size="60%" data-background-opacity="40%">
<div class="org-src-container">

<pre class="src src-nix"><span style="color: #9ca0a4;"># </span><span style="color: #9ca0a4;">attr set as argument, defined attr must be passed</span>
<span style="color: #9ca0a4;"># </span><span style="color: #9ca0a4;">?, default value</span>
<span style="color: #9ca0a4;"># </span><span style="color: #9ca0a4;">... , extra attrs</span>
<span style="color: #9ca0a4;"># </span><span style="color: #9ca0a4;">@name, named attr set</span>
nix-repl&gt; <span style="color: #e45649;">let</span>
            <span style="color: #6a1868;">f</span> = {a, b ? <span style="color: #da8548; font-weight: bold;">1</span>, ...}@args: a + b + args.c;
          <span style="color: #e45649;">in</span>
            f { <span style="color: #6a1868;">a</span> = <span style="color: #da8548; font-weight: bold;">1</span>; <span style="color: #6a1868;">c</span> = <span style="color: #da8548; font-weight: bold;">1</span>; }
<span style="color: #da8548; font-weight: bold;">3</span>
</pre>
</div>

</section>
<section id="slide-org1e1b615" data-background="https://upload.wikimedia.org/wikipedia/commons/2/28/Nix_snowflake.svg" data-background-size="60%" data-background-opacity="40%">
<h3 id="org1e1b615">Domain specific</h3>
<div class="org-src-container">

<pre class="src src-nix">
nix-repl&gt; <span style="color: #da8548; font-weight: bold;">6</span>/<span style="color: #da8548; font-weight: bold;">3</span>
/Users/mskalski/org/<span style="color: #da8548; font-weight: bold;">6</span>/<span style="color: #da8548; font-weight: bold;">3</span>

nix-repl&gt; <span style="color: #e45649;">let</span>
            <span style="color: #6a1868;">r</span> = <span style="color: #da8548; font-weight: bold;">6</span>/<span style="color: #da8548; font-weight: bold;">3</span>;
          <span style="color: #e45649;">in</span>
            builtins.typeOf r
<span style="color: #50a14f;">"path"</span>
</pre>
</div>

</section>
<section id="slide-org116981c" data-background="https://upload.wikimedia.org/wikipedia/commons/2/28/Nix_snowflake.svg" data-background-size="60%" data-background-opacity="40%">
<h3 id="org116981c">Lazy evaluation</h3>
<div class="org-src-container">

<pre class="src src-nix">nix-repl&gt; <span style="color: #e45649;">let</span>
            <span style="color: #6a1868;">f</span> = builtins.fetchurl <span style="color: #50a14f;">"http://127.0.0.1:8000/f"</span>;
            <span style="color: #6a1868;">b</span> = <span style="color: #da8548; font-weight: bold;">3</span>;
          <span style="color: #e45649;">in</span>
            b
<span style="color: #da8548; font-weight: bold;">3</span>
<span style="color: #9ca0a4;"># </span><span style="color: #9ca0a4;">no request has been made to http server</span>
</pre>
</div>

<aside class="notes">
nil
</aside>


</section>
</section>
<section>
<section id="slide-org20095f1" data-background="https://upload.wikimedia.org/wikipedia/commons/2/28/Nix_snowflake.svg" data-background-size="60%" data-background-opacity="40%">
<h2 id="org20095f1">What I can do with nix?</h2>
<div class="outline-text-2" id="text-org20095f1">
</div>
</section>
<section id="slide-org6f47028" data-background="https://upload.wikimedia.org/wikipedia/commons/2/28/Nix_snowflake.svg" data-background-size="60%" data-background-opacity="40%">
<h3 id="org6f47028">Task shell</h3>
<p>
Ephermal shell with new package
</p>
<div class="org-src-container">

<pre class="src src-fish">~ &#10095; cowsay <span style="color: #50a14f;">"nix is awesome!"</span>
<span style="color: #a626a4;">Unknown</span> <span style="color: #a626a4;">command</span>: cowsay

~ &#10095; nix-shell -p cowsay
[nix-shell:~]$ cowsay <span style="color: #50a14f;">"nix is awesome!"</span>
 <span style="color: #a626a4;">_________________</span>
<span style="color: #a626a4;">&lt;</span> nix is awesome!<span style="color: #4078f2; font-weight: bold;"> &gt;</span>
 <span style="color: #a626a4;">-----------------</span>
        <span style="color: #4078f2; font-weight: bold;">\   ^__^</span>
         <span style="color: #4078f2; font-weight: bold;">\</span>  (<span style="color: #a626a4;">oo</span>)<span style="color: #4078f2; font-weight: bold;">\</span>_______
            (<span style="color: #a626a4;">__</span>)<span style="color: #4078f2; font-weight: bold;">\</span>       )<span style="color: #4078f2; font-weight: bold;">\</span>/<span style="color: #4078f2; font-weight: bold;">\</span>
                <span style="color: #4078f2; font-weight: bold;">|</span>|----w <span style="color: #4078f2; font-weight: bold;">|</span>
                <span style="color: #e45649;">||</span>     <span style="color: #e45649;">||</span>

[nix-shell:~]$ <span style="color: #e45649;">exit</span>

~ &#10095; cowsay <span style="color: #50a14f;">"nix is awesome!"</span>
<span style="color: #a626a4;">Unknown</span> <span style="color: #a626a4;">command</span>: cowsay
</pre>
</div>
</section>
<section data-background="https://upload.wikimedia.org/wikipedia/commons/2/28/Nix_snowflake.svg" data-background-size="60%" data-background-opacity="40%">
<p>
Create ad hoc env with python and needed modules
</p>
<div style="font-size: 80%;">
<div class="org-src-container">

<pre class="src src-fish">~ &#10095; python3 -c <span style="color: #50a14f;">"import bcrypt; print(bcrypt.__version__)"</span>
<span style="color: #a626a4;">Traceback</span> (<span style="color: #a626a4;">most</span> recent call last):
  <span style="color: #a626a4;">File</span> <span style="color: #50a14f;">"&lt;string&gt;"</span>, line <span style="color: #da8548; font-weight: bold;">1</span>, in<span style="color: #4078f2; font-weight: bold;"> &lt;module&gt;</span>
<span style="color: #4078f2; font-weight: bold;">ModuleNotFoundError:</span> No module named <span style="color: #50a14f;">'bcrypt'</span>

~ &#10095; nix-shell -p <span style="color: #50a14f;">"python3.withPackages(p: [ p.bcrypt ])"</span>
[nix-shell:~]$ python3 -c <span style="color: #50a14f;">"import bcrypt; print(bcrypt.__version__)"</span>
<span style="color: #da8548; font-weight: bold;">4.0</span>.<span style="color: #da8548; font-weight: bold;">1</span>
</pre>
</div>
</div>

</section>
<section id="slide-org99a9bfc" data-background="https://upload.wikimedia.org/wikipedia/commons/2/28/Nix_snowflake.svg" data-background-size="60%" data-background-opacity="40%">
<h3 id="org99a9bfc">Profiles</h3>
<p>
Persistent environments with rollback history and atomic updates
</p>


<div id="orgf0199a5" class="figure">
<p><img src="./images/profiles.png" alt="profiles.png" />
</p>
</div>

<div style="font-size: 40%;">
<p>
<i>Source: The Purely Functional Software Deployment Model</i>
</p>
</div>
</section>
<section data-background="https://upload.wikimedia.org/wikipedia/commons/2/28/Nix_snowflake.svg" data-background-size="60%" data-background-opacity="40%">
<div class="org-src-container">

<pre class="src src-fish"><span style="color: #9ca0a4;"># </span><span style="color: #9ca0a4;">Install btop package in user environment (new generation)</span>
$ nix profile install nixpkgs<span style="color: #9ca0a4;">#</span><span style="color: #9ca0a4;">btop</span>

<span style="color: #9ca0a4;"># </span><span style="color: #9ca0a4;">Compare changes between generations</span>
$ nix profile diff-closures
<span style="color: #a626a4;">Version</span> <span style="color: #da8548; font-weight: bold;">6</span> -&gt; <span style="color: #da8548; font-weight: bold;">7</span>:
  <span style="color: #a626a4;">btop</span>: &#8709; &#8594; <span style="color: #da8548; font-weight: bold;">1.2</span>.<span style="color: #da8548; font-weight: bold;">13</span>, +1637.<span style="color: #da8548; font-weight: bold;">7</span> KiB
  <span style="color: #a626a4;">gcc</span>: &#8709; &#8594; <span style="color: #da8548; font-weight: bold;">12.3</span>.<span style="color: #da8548; font-weight: bold;">0</span>, +15845.<span style="color: #da8548; font-weight: bold;">2</span> KiB
  <span style="color: #a626a4;">glibc</span>: &#8709; &#8594; <span style="color: #da8548; font-weight: bold;">2</span>.37-8, +29536.<span style="color: #da8548; font-weight: bold;">3</span> KiB
  <span style="color: #a626a4;">libidn2</span>: &#8709; &#8594; <span style="color: #da8548; font-weight: bold;">2.3</span>.<span style="color: #da8548; font-weight: bold;">4</span>, +350.<span style="color: #da8548; font-weight: bold;">4</span> KiB
  <span style="color: #a626a4;">libunistring</span>: &#8709; &#8594; <span style="color: #da8548; font-weight: bold;">1.1</span>, +1813.<span style="color: #da8548; font-weight: bold;">8</span> KiB
  <span style="color: #a626a4;">xgcc</span>: &#8709; &#8594; <span style="color: #da8548; font-weight: bold;">12.3</span>.<span style="color: #da8548; font-weight: bold;">0</span>, +139.<span style="color: #da8548; font-weight: bold;">1</span> KiB

<span style="color: #9ca0a4;"># </span><span style="color: #9ca0a4;">Revert to previous generation</span>
$ nix profile rollback
<span style="color: #a626a4;">switching</span> profile from version <span style="color: #da8548; font-weight: bold;">7</span> to <span style="color: #da8548; font-weight: bold;">6</span>
</pre>
</div>

</section>
<section id="slide-org92e8eda" data-background="https://upload.wikimedia.org/wikipedia/commons/2/28/Nix_snowflake.svg" data-background-size="60%" data-background-opacity="40%">
<h3 id="org92e8eda">Flakes</h3>
<p>
Introduce <code>flake.nix</code> and  <code>flake.lock</code> to clear definitions of inputs and their versions.
</p>

</section>
<section id="slide-orgf7a9153" data-background="https://upload.wikimedia.org/wikipedia/commons/2/28/Nix_snowflake.svg" data-background-size="60%" data-background-opacity="40%">
<h4 id="orgf7a9153">Compose projects</h4>
<p>
Easy access, locked inputs, can produce variety of outputs binaries, container images etc..
</p>

<div style="font-size: 70%;">
<div class="org-src-container">

<pre class="src src-fish">$ nix flake show github:michalskalski/axact
<span style="color: #a626a4;">github</span>:michalskalski/axact/9ca2f50dc4fb836af6e16dc03190cd2055d9f24b
<span style="color: #a626a4;">&#9500;&#9472;&#9472;&#9472;devShell</span>
<span style="color: #a626a4;">&#9474;</span>   &#9500;&#9472;&#9472;&#9472;aarch64-darwin omitted (<span style="color: #a626a4;">use</span> <span style="color: #50a14f;">'--all-systems'</span> to show)
<span style="color: #a626a4;">&#9474;</span>   &#9500;&#9472;&#9472;&#9472;aarch64-linux omitted (<span style="color: #a626a4;">use</span> <span style="color: #50a14f;">'--all-systems'</span> to show)
<span style="color: #a626a4;">&#9474;</span>   &#9500;&#9472;&#9472;&#9472;x86_64-darwin omitted (<span style="color: #a626a4;">use</span> <span style="color: #50a14f;">'--all-systems'</span> to show)
<span style="color: #a626a4;">&#9474;</span>   &#9492;&#9472;&#9472;&#9472;x86_64-linux: development environment <span style="color: #50a14f;">'nix-shell'</span>
<span style="color: #a626a4;">&#9492;&#9472;&#9472;&#9472;packages</span>
    <span style="color: #a626a4;">&#9500;&#9472;&#9472;&#9472;aarch64-darwin</span>
    <span style="color: #a626a4;">&#9474;</span>   &#9500;&#9472;&#9472;&#9472;bin omitted (<span style="color: #a626a4;">use</span> <span style="color: #50a14f;">'--all-systems'</span> to show)
    <span style="color: #a626a4;">&#9474;</span>   &#9500;&#9472;&#9472;&#9472;default omitted (<span style="color: #a626a4;">use</span> <span style="color: #50a14f;">'--all-systems'</span> to show)
    <span style="color: #a626a4;">&#9474;</span>   &#9492;&#9472;&#9472;&#9472;ociImage omitted (<span style="color: #a626a4;">use</span> <span style="color: #50a14f;">'--all-systems'</span> to show)
    <span style="color: #a626a4;">&#9500;&#9472;&#9472;&#9472;aarch64-linux</span>
    <span style="color: #a626a4;">&#9474;</span>   &#9500;&#9472;&#9472;&#9472;bin omitted (<span style="color: #a626a4;">use</span> <span style="color: #50a14f;">'--all-systems'</span> to show)
    <span style="color: #a626a4;">&#9474;</span>   &#9500;&#9472;&#9472;&#9472;default omitted (<span style="color: #a626a4;">use</span> <span style="color: #50a14f;">'--all-systems'</span> to show)
    <span style="color: #a626a4;">&#9474;</span>   &#9492;&#9472;&#9472;&#9472;ociImage omitted (<span style="color: #a626a4;">use</span> <span style="color: #50a14f;">'--all-systems'</span> to show)
    <span style="color: #a626a4;">&#9500;&#9472;&#9472;&#9472;x86_64-darwin</span>
    <span style="color: #a626a4;">&#9474;</span>   &#9500;&#9472;&#9472;&#9472;bin omitted (<span style="color: #a626a4;">use</span> <span style="color: #50a14f;">'--all-systems'</span> to show)
    <span style="color: #a626a4;">&#9474;</span>   &#9500;&#9472;&#9472;&#9472;default omitted (<span style="color: #a626a4;">use</span> <span style="color: #50a14f;">'--all-systems'</span> to show)
    <span style="color: #a626a4;">&#9474;</span>   &#9492;&#9472;&#9472;&#9472;ociImage omitted (<span style="color: #a626a4;">use</span> <span style="color: #50a14f;">'--all-systems'</span> to show)
    <span style="color: #a626a4;">&#9492;&#9472;&#9472;&#9472;x86_64-linux</span>
        <span style="color: #a626a4;">&#9500;&#9472;&#9472;&#9472;bin</span>: package <span style="color: #50a14f;">'axact-0.1.0'</span>
        <span style="color: #a626a4;">&#9500;&#9472;&#9472;&#9472;default</span>: package <span style="color: #50a14f;">'axact-0.1.0'</span>
        <span style="color: #a626a4;">&#9492;&#9472;&#9472;&#9472;ociImage</span>: package <span style="color: #50a14f;">'docker-image-axact.tar.gz'</span>
</pre>
</div>
</div>
</section>
<section data-background="https://upload.wikimedia.org/wikipedia/commons/2/28/Nix_snowflake.svg" data-background-size="60%" data-background-opacity="40%">
<p>
Build binary
</p>
<div style="font-size: 70%;">
<div class="org-src-container">

<pre class="src src-fish">$ nix build github:michalskalski/axact<span style="color: #9ca0a4;">#</span><span style="color: #9ca0a4;">packages.x86_64-linux.bin</span>

<span style="color: #9ca0a4;"># </span><span style="color: #9ca0a4;">by default it produce 'result' symlink in current directory</span>
$ ls -l
<span style="color: #a626a4;">result</span> -&gt; /nix/store/qh4y4iwh0q40q5xxlp61bimhx8i6dp9i-axact-0.<span style="color: #da8548; font-weight: bold;">1.0</span>

$ nix path-info --json $(<span style="color: #a626a4;">realpath</span><span style="color: #a626a4;"> result</span>) <span style="color: #4078f2; font-weight: bold;">|</span> <span style="color: #a626a4;">jq</span> .
[
  {
    <span style="color: #50a14f;">"deriver"</span>: <span style="color: #50a14f;">"/nix/store/gkxa58jxq5a9z7187afx0lywkckxr05b-axact-0.1.0.drv"</span>,
    <span style="color: #50a14f;">"narHash"</span>: <span style="color: #50a14f;">"sha256-cLMwsb0BQCRGXB1M+KGruZB+lR0gZRV3UKOFalkgONE="</span>,
    <span style="color: #50a14f;">"narSize"</span>: <span style="color: #da8548; font-weight: bold;">6295640</span>,
    <span style="color: #50a14f;">"path"</span>: <span style="color: #50a14f;">"/nix/store/qh4y4iwh0q40q5xxlp61bimhx8i6dp9i-axact-0.1.0"</span>,
    <span style="color: #50a14f;">"references"</span>: [
      <span style="color: #50a14f;">"/nix/store/c50v7bf341jsza0n07784yvzp5fzjpn5-gcc-12.3.0-lib"</span>,
      <span style="color: #50a14f;">"/nix/store/vq3sdi8l15rzfl5zvmwpafrzis4sm6xf-glibc-2.37-8"</span>
    ],
    <span style="color: #50a14f;">"registrationTime"</span>: <span style="color: #da8548; font-weight: bold;">1692975733</span>,
    <span style="color: #50a14f;">"ultimate"</span>: <span style="color: #e45649;">true</span>,
    <span style="color: #50a14f;">"valid"</span>: <span style="color: #e45649;">true</span>
  }
]
</pre>
</div>
</div>
</section>
<section data-background="https://upload.wikimedia.org/wikipedia/commons/2/28/Nix_snowflake.svg" data-background-size="60%" data-background-opacity="40%">
<p>
Build container image
</p>
<div style="font-size: 70%;">
<div class="org-src-container">

<pre class="src src-fish">$ nix build github:michalskalski/axact<span style="color: #9ca0a4;">#</span><span style="color: #9ca0a4;">packages.x86_64-linux.ociImage</span>

$ ls -l result
<span style="color: #a626a4;">result</span> -&gt; /nix/store/sn1yivqy1c1qjhypq3n515g4r47rgp0k-docker-image-axact.tar.gz

<span style="color: #9ca0a4;"># </span><span style="color: #9ca0a4;">load image to local docker instance</span>
$ docker load<span style="color: #4078f2; font-weight: bold;"> &lt; result</span>
<span style="color: #4078f2; font-weight: bold;">941c04e2c681:</span> Loading layer [<span style="color: #a626a4;">=======================================&gt;</span>]  <span style="color: #da8548; font-weight: bold;">47</span>.59MB/47.59MB
<span style="color: #a626a4;">Loaded</span> image: axact:latest

<span style="color: #9ca0a4;"># </span><span style="color: #9ca0a4;">but docker is not needed</span>
$ skopeo copy <span style="color: #50a14f;">"docker-archive://$(</span><span style="color: #a626a4;">realpath result</span><span style="color: #50a14f;">)"</span> <span style="color: #50a14f;">"docker://registry-address/img:tag"</span>
</pre>
</div>
</div>

</section>
<section id="slide-org01f65ad" data-background="https://upload.wikimedia.org/wikipedia/commons/2/28/Nix_snowflake.svg" data-background-size="60%" data-background-opacity="40%">
<h4 id="org01f65ad">Development shell</h4>
<p>
Allow define development environment where all dependencies for your app are available, and share the same experience with other developers.
</p>

<div class="org-src-container">

<pre class="src src-fish">$ nix develop github:michalskalski/axact
</pre>
</div>

<div class="org-src-container">

<pre class="src src-nix"><span style="color: #9ca0a4;"># </span><span style="color: #9ca0a4;">flake.nix</span>
...
<span style="color: #6a1868;">devShell</span> = mkShell {
    <span style="color: #6a1868;">inputsFrom</span> = [ bin ];
    <span style="color: #6a1868;">buildInputs</span> = [dive skopeo] ++ darwinPkgs;
};
</pre>
</div>
</section>
<section data-background="https://upload.wikimedia.org/wikipedia/commons/2/28/Nix_snowflake.svg" data-background-size="60%" data-background-opacity="40%">
<p>
Use <a href="https://direnv.net/">direnv</a> for seamless experience, your editor probably understand it too.
</p>

<div class="org-src-container">

<pre class="src src-fish">$ ls -a project/
.envrc  flake.nix ..

$ cat project/.envrc
<span style="color: #a626a4;">use</span> flake

$ <span style="color: #a626a4;">cd</span> project/
<span style="color: #a626a4;">direnv</span>: error project/.envrc is blocked.
<span style="color: #a626a4;">Run</span> `direnv allow` to approve its content

$ direnv allow
<span style="color: #a626a4;">direnv</span>: loading project/.envrc
<span style="color: #a626a4;">direnv</span>: using flake
<span style="color: #a626a4;">direnv</span>: nix-direnv: using cached dev shell
</pre>
</div>


</section>
<section id="slide-org91df977" data-background="https://upload.wikimedia.org/wikipedia/commons/2/28/Nix_snowflake.svg" data-background-size="60%" data-background-opacity="40%">
<h4 id="org91df977">Demo</h4>


</section>
</section>
<section>
<section id="slide-org6ed6599" data-background="https://upload.wikimedia.org/wikipedia/commons/2/28/Nix_snowflake.svg" data-background-size="60%" data-background-opacity="40%">
<h2 id="org6ed6599">One <del>ring</del> system to rule them all</h2>
<p>
Nix can be use to install and configure applications but also take care about whole OS configuration.
</p>

</section>
<section id="slide-org67a7f25" data-background="https://upload.wikimedia.org/wikipedia/commons/2/28/Nix_snowflake.svg" data-background-size="60%" data-background-opacity="40%">
<h3 id="org67a7f25">NixOS</h3>
<p>
Fully integrated with nix, both from packages and configuration standpoint
</p>

<p class="fragment (appear)">
By default uses <code>channels</code> as a source of packages versions.
</p>
<ul>
<li class="fragment appear">stable channels released every six month (for ex. 22.11, 23.05)</li>
<li class="fragment appear">unstable - rolling release</li>

</ul>

</section>
<section id="slide-org3c47e36" data-background="https://upload.wikimedia.org/wikipedia/commons/2/28/Nix_snowflake.svg" data-background-size="60%" data-background-opacity="40%">
<h4 id="org3c47e36">Declarative description of OS</h4>
<p>
Entire system can be described through <a href="https://nixos.org/manual/nixos/stable/options.html">declarative configuration</a>.
</p>

<p class="fragment (appear)">
Store configuration in repository, even better, make it <code>flake</code> and describe multiple hosts as separate outputs.
</p>

<p class="fragment (appear)">
Share common configuration between hosts, making it more modular.
</p>

</section>
<section id="slide-orgf0b8d17" data-background="https://upload.wikimedia.org/wikipedia/commons/2/28/Nix_snowflake.svg" data-background-size="60%" data-background-opacity="40%">
<h4 id="orgf0b8d17">Safe changes</h4>
<p>
Test your new configuration in <a href="https://nixos.wiki/wiki/NixOS:nixos-rebuild_build-vm">VM</a> before applying on host:
</p>

<div class="org-src-container">

<pre class="src src-fish"><span style="color: #9ca0a4;"># </span><span style="color: #9ca0a4;">will start local vm with current system configuration</span>
$ nixos-rebuild build-vm
</pre>
</div>

</section>
<section data-background="https://upload.wikimedia.org/wikipedia/commons/2/28/Nix_snowflake.svg" data-background-size="60%" data-background-opacity="40%">
<p>
Every package install in system profile creates new generation and entry for it in bootloader.
</p>

<p class="fragment (appear)">
System does not start after upgrade?
</p>

<p class="fragment (appear)">
Boot from previous generation.
</p>


<div id="org1a9a338" class="figure">
<p><img src="./images/nixos-boot.png" alt="nixos-boot.png" />
</p>
</div>

</section>
<section data-background="https://upload.wikimedia.org/wikipedia/commons/2/28/Nix_snowflake.svg" data-background-size="60%" data-background-opacity="40%">


<div id="org69b0271" class="figure">
<p><img src="./images/nixos-install.jpg" alt="nixos-install.jpg" width="30%" />
</p>
</div>

<p>
Run from livecd and restore system from existing config with one command, or generate disk image ahead.
</p>

</section>
<section id="slide-org8ce217a" data-background="https://upload.wikimedia.org/wikipedia/commons/2/28/Nix_snowflake.svg" data-background-size="60%" data-background-opacity="40%">
<h3 id="org8ce217a">nix-darwin</h3>
<p>
Tries to replicate NixOS behaviour on macOS
</p>

<p>
<a href="https://github.com/LnL7/nix-darwin">https://github.com/LnL7/nix-darwin</a>
</p>

</section>
<section id="slide-orgf1b23a9" data-background="https://upload.wikimedia.org/wikipedia/commons/2/28/Nix_snowflake.svg" data-background-size="60%" data-background-opacity="40%">
<h3 id="orgf1b23a9">Home manager</h3>
<p>
<a href="https://github.com/nix-community/home-manager">https://github.com/nix-community/home-manager</a>
</p>

<p>
Standalone or module for NixOS or nix-darwin
</p>

<p>
Rich library of software configuration.
</p>


</section>
</section>
<section>
<section id="slide-org0871bbd" data-background="https://upload.wikimedia.org/wikipedia/commons/2/28/Nix_snowflake.svg" data-background-size="60%" data-background-opacity="40%">
<h2 id="org0871bbd">Additional resources</h2>
<p>
Nix:
</p>
<ul>
<li><a href="https://nixos.org/learn">https://nixos.org/learn</a></li>
<li><a href="https://zero-to-nix.com/">https://zero-to-nix.com/</a></li>
<li><a href="https://nixos.org/guides/nix-pills/">https://nixos.org/guides/nix-pills/</a></li>

</ul>

<p>
Build systems:
</p>
<ul>
<li><a href="https://www.microsoft.com/en-us/research/uploads/prod/2018/03/build-systems.pdf">Build Systems à la Carte (2018)</a></li>
<li>YouTube: <a href="https://www.youtube.com/watch?v=BQVT6wiwCxM">Build Systems à la Carte</a></li>

</ul>
</section>
</section>
</div>
</div>
<script src="./reveal.js/dist/reveal.js"></script>
<script src="./reveal.js/plugin/markdown/markdown.js"></script>
<script src="./reveal.js/plugin/notes/notes.js"></script>
<script src="./reveal.js/plugin/search/search.js"></script>
<script src="./reveal.js/plugin/zoom/zoom.js"></script>
<script>
// Full list of configuration options available here:
// https://github.com/hakimel/reveal.js#configuration
Reveal.initialize({

controls: true,
progress: true,
history: false,
center: true,
slideNumber: 'c',
rollingLinks: false,
keyboard: true,
mouseWheel: false,
fragmentInURL: false,
hashOneBasedIndex: false,
pdfSeparateFragments: true,
overview: true,

transition: 'none',
transitionSpeed: 'default',

// Plugins with reveal.js 4.x
plugins: [ RevealMarkdown, RevealNotes, RevealSearch, RevealZoom ],

// Optional libraries used to extend reveal.js
dependencies: [
]

});
</script>
</body>
</html>
